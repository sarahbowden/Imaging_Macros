# 1. Macros
## How To
- Save macro with extension .ijm
- Select a region of interest (ROI) from an imaged WMISH embryo
  - For most accurate results it is important to keep ROI selection size consistent across all embryos in analysis (see below)
- Quantify a set (biological replicates of a single condition) at once (Process > Batch > Macro)
- or individual images (Plugins > Macros > Run...)
- Copy from the results table "% Area" (ISHquantification_Area) or "Count" (ISHquantification_Count) to quantify

### **Important note**
- I always create a Results folder for each batch processing analysis, and then I check that the black mask covers the stained regions.
- Convert to Mask is a binary process and black is selected as the smallest coverage. If images have more staining than background, this may be flipped.
- If this is the case I either manually perform these steps to ensure the correct region is covered (you can use Image > Adjust > Threshold..., or invert the ROI).
- In theory, if the whole batch needs to be inverted, you can add an inversion line to the macro prior to Convert to Mask.

- ISHquantification_Count has an additional Watershedding step to deconvolute doublets/triplets. This can be useful when staining has very clear punctae, but often has a risk of mis-representing the area.
  - Mainly useful when a manipulation does not change the area of staining but instead changes the size and number of cells.


## Step-by-step process
1. Renames each file to make downstream processes simpler
2. Colour Deconvolution to identify BM-stained tissue / eliminate background colours
3. Selects purple (BM-stained) channel
4. Prevents FIJI from assumption background = dark
5. Creates a mask based on differences between staining and background
6. _(only on ISHquantification_count)_ Generates gaps between individual punctae in cases of doublets/triplets etc
7. Analyses particles; counts number of punctae/regions, and calculates area covered by black mask


![ROI example](/Macros/Example_ROI.jpg "ROI")  
_Above: Region of interest selected for this analysis in each stage 32 embryo._

# 2. Quantification script

## Getting started
Run the following line to install the dependencies for R:
```R
install.packages(c("ggplot2", "dplyr", "readr", "stringr", "rlang"))
```

## Input files
Input files are generated by calculating the Count and % Area in a defined region of interest (ROI) using ImageJ and must be in .csv format. An optional third column can be used if calculating multiple parameters from the same file.
The structure of these files must be as follows:
| Condition | % Area | Count |
|-----------|--------|-------|
| A         | 36.943 | 320   |
| A         | 17.694 | 249   |
| B         | 21.359 | 252   |
| B         | 20.399 | 229   |
| UC   | 22.337 | 315   |
| Control   | 25.744 | 249   |
\\
Controls should be labelled as UC. Morpholino conditions should be labelled with "MO" at the end of the name. Rescue conditions should be labelled with "Rescue" at the end of the name.
## Usage
This script runs a folder containing .csv files through an R script and spits out ggplot files with calculated p values (wilcoxon rank sum test) for comparisons to the control (black) and comparisons of the morphant to the rescue (red). You must define arguments in the following order:
```bash
./run_quantification.sh [first argument: input directory] [second argument: output directory]
```
###
As a general rule, ISH quantification is best used for calculating the percentage of the ROI which is stained. However, in some circumstances, calculating the number of cells stained in an ROI can be a useful metric of quantification (e.g. more cells are specified, but these cells are smaller). In these instances, you can use the count_run_quantification.sh file to plot data generated from the count rather than Area. 

(This can be repurposed for any other measure, it simply takes data from the third column rather than second.)
